<!DOCTYPE html>

<head>
  <meta charset="utf-8">
  <style>

  .links line {
    stroke: #999;
    stroke-opacity: 0.2;
  }

  .nodes circle {
    /*stroke: #fff;*/
    /*stroke-width: 1.5px;*/
  }

  </style>
</head>

<body>

  <div id="chartBox">
    <svg width="1000" height="1000"></svg>
  </div>

</body>

<script src="https://d3js.org/d3.v4.min.js"></script>
<script>

// selectors

var svg = d3.select("svg"),
    width = +svg.attr("width"),
    height = +svg.attr("height");

// var color = d3.scaleOrdinal(d3.schemeCategory20);
// .force("link", d3.forceLink(links).distance(20).strength(1))

var simulation = d3.forceSimulation()
    .force("link", d3.forceLink().id(function(d) { return d.id; }).distance(1))
    .force("charge", d3.forceManyBody())
    .force("center", d3.forceCenter(width / 2, height / 2));


    // force.charge(function(node) {
    //     if (node.className === 'red')  return -3000;
    //     return -30;
    // });

d3.json("data/forceChart-sm-1.json", function(error, graph) {
  if (error) throw error;

  // var gtoggle = d3.select("#chartBox")
  //     .selectAll("div.gtoggle")
  //     .data(graph.nodes)
  //     .enter()
  //     .append("div")
  //     .classed("gtoggle", true)
  //     .text(function(d) {
  //       if (d.hasOwnProperty('group')) {
  //         return d.group;
  //       }
  //     });

  console.log(graph.nodes);

  var link = svg.append("g")
      .attr("class", "links")
      .selectAll("line")
      .data(graph.links)
      .enter()
      .append("line")
      .attr("stroke-width", 1);
  //
  var node = svg.append("g")
      .attr("class", "nodes")
      .selectAll("circle")
      .data(graph.nodes)
      .enter()
      .append("circle")
      .attr("r", 3)
      .attr("fill", 'blue');
  //
  node.append("title")
      .text(function(d) { return d.id; });

  // Uncaught TypeError: Cannot create property 'vx' on string  '//en.wiktionary.org/wiki/Dada'
  simulation
      .nodes(graph.nodes)
      .on("tick", ticked);
  //
  simulation.force("link")
      .links(graph.links);
  //


  function ticked() {
    console.log('ticked call');

    link
        .attr("x1", function(d) { return d.source.x; })
        .attr("y1", function(d) { return d.source.y; })
        .attr("x2", function(d) { return d.target.x; })
        .attr("y2", function(d) { return d.target.y; });

    node
        .attr("cx", function(d) { return d.x; })
        .attr("cy", function(d) { return d.y; });



  }
});


</script>

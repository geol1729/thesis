function getDate(e){var t="";return e.value.hasOwnProperty("date")&&(t=e.value.date),e.value.hasOwnProperty("bdate")&&(t="b"+e.value.bdate),e.value.hasOwnProperty("ddate")&&(t+="d"+e.value.ddate),t}function showDeets(){return function(e){var t=e.value.title,n=e.value.hasOwnProperty("location")?e.value.location:"",r=getDate(e),a="Rank: "+e.value.rank+"%";console.log(r);var s=50;d3.select(this).transition().attrs({r:circleSize(4)});var l=d3.select("div#chart").append("div").attrs({class:"nodeDeets card"}).styles({left:e.x+25+"px",top:e.y-50+"px",opacity:0});e.value.hasOwnProperty("image")&&null!=e.value.image&&l.append("div").classed("imgBox",!0).append("img").attrs({src:e.value.image,class:"svgHoverImg"}),l.append("p").text(t).append("span").classed("details",!0).html(" <br/> "+a+" <br/> "+n+" <br/> "+r),l.transition().style("opacity",1)}}function circleSize(e){return function(t){return"Dada"==t.id?5+e:2*Math.ceil(100*+t.value.rank)+e}}function hideDeets(){return function(e){d3.select("div.nodeDeets").remove(),d3.select(this).transition().attrs({r:circleSize(0)})}}function nodeClick(){return function(e){console.log("CLICK"),d3.select("#nav").styles({display:"none"}),pathBack(e)}}function pathBack(e){var t,n=!1;console.log(e),1!=e.value.distance&&e.value.hasOwnProperty("distance")?(n=!0,t=e.value.roots):(t=["Dada"],console.log(t));for(var r in t){var a="."+t[r]+" ."+e.id;d3.select(a).styles({"stroke-opacity":1,display:"visible"}),console.log(a)}}function toggler(){return function(e){var t=d3.select("div.toggle.g"+e.value.id),n=d3.select("svg").selectAll("circle.g"+e.value.id);t.classed("clicked")?(t.classed("clicked",!1),n.classed("toggled",!1)):(t.classed("clicked",!0),n.classed("toggled",!0))}}var svg=d3.select("svg"),width=+svg.attr("width"),height=+svg.attr("height"),zg=svg.append("g"),slider=document.getElementById("slider-connect");noUiSlider.create(slider,{start:[1500,2018],connect:[!1,!0,!1],range:{min:1500,max:2018}});var sVals;slider.noUiSlider.on("update",function(){sVals=slider.noUiSlider.get(),d3.select("span#s0").text(Math.floor(sVals[0])),d3.select("span#s1").text(Math.ceil(sVals[1]))}),d3.json("data/forceChart-d2fullSet.json",function(e,t){function n(e){var t=e.progress;meter.style.width=100*t+"%"}function r(e){var t=e.nodes,n=e.links;meter.style.display="none",console.log(t),console.log(n);var r=zg.append("g").attr("class","links").selectAll("line").data(n).enter().append("line").attrs({x1:function(e){return e.source.x},y1:function(e){return e.source.y},x2:function(e){return e.target.x},y2:function(e){return e.target.y},class:function(e){return e.source.id+" "+e.target.id}}),a=zg.append("g").attr("class","nodes").selectAll("circle").data(t).enter().append("circle").attrs({r:circleSize(0),cx:function(e){return e.x},cy:function(e){return e.y},class:function(e){var t="";for(var n in e.value.group)t=t+" g"+e.value.group[n];return t},id:function(e){return e.id}}).on("mouseover",showDeets()).on("mouseout",hideDeets()).on("click",nodeClick());$(function(){var e=urlList;$("#search").autocomplete({source:e})})}if(e)throw e;var a=d3.select("#catBox").selectAll("div.toggle").data(t.groupKey).enter().append("div").attr("class",function(e){return"toggle g"+e.value.id}).text(function(e){return e.key});a.append("input").attrs({class:"tgl tgl-light",id:function(e){return"g"+e.value.id},type:"checkbox"}).on("mouseup",toggler()),a.append("label").attrs({class:"tgl-btn",for:function(e){return"g"+e.value.id}}).on("mouseup",toggler());var s=t.links,l=t.nodes;meter=document.querySelector("#progress"),worker=new Worker("js/worker.js"),urlList=[];for(var o in l)urlList.push(l[o].id);worker.postMessage({nodes:l,links:s}),worker.onmessage=function(e){switch(e.data.type){case"tick":return n(e.data);case"end":return r(e.data)}}});